(function(){"use strict";const W="3.7.3",Ke=W,Ze=typeof atob=="function",Ve=typeof btoa=="function",_=typeof Buffer=="function",G=typeof TextDecoder=="function"?new TextDecoder:void 0,J=typeof TextEncoder=="function"?new TextEncoder:void 0,We="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",U=Array.prototype.slice.call(We),R=(e=>{let n={};return e.forEach((t,r)=>n[t]=r),n})(U),Ge=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,h=String.fromCharCode.bind(String),Q=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):(e,n=t=>t)=>new Uint8Array(Array.prototype.slice.call(e,0).map(n)),Y=e=>e.replace(/=/g,"").replace(/[+\/]/g,n=>n=="+"?"-":"_"),ee=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),te=e=>{let n,t,r,o,i="";const s=e.length%3;for(let a=0;a<e.length;){if((t=e.charCodeAt(a++))>255||(r=e.charCodeAt(a++))>255||(o=e.charCodeAt(a++))>255)throw new TypeError("invalid character found");n=t<<16|r<<8|o,i+=U[n>>18&63]+U[n>>12&63]+U[n>>6&63]+U[n&63]}return s?i.slice(0,s-3)+"===".substring(s):i},D=Ve?e=>btoa(e):_?e=>Buffer.from(e,"binary").toString("base64"):te,B=_?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let r=0,o=e.length;r<o;r+=4096)t.push(h.apply(null,e.subarray(r,r+4096)));return D(t.join(""))},O=(e,n=!1)=>n?Y(B(e)):B(e),Je=e=>{if(e.length<2){var n=e.charCodeAt(0);return n<128?e:n<2048?h(192|n>>>6)+h(128|n&63):h(224|n>>>12&15)+h(128|n>>>6&63)+h(128|n&63)}else{var n=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return h(240|n>>>18&7)+h(128|n>>>12&63)+h(128|n>>>6&63)+h(128|n&63)}},Qe=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,ne=e=>e.replace(Qe,Je),re=_?e=>Buffer.from(e,"utf8").toString("base64"):J?e=>B(J.encode(e)):e=>D(ne(e)),m=(e,n=!1)=>n?Y(re(e)):re(e),oe=e=>m(e,!0),Ye=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,et=e=>{switch(e.length){case 4:var n=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),t=n-65536;return h((t>>>10)+55296)+h((t&1023)+56320);case 3:return h((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return h((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},ie=e=>e.replace(Ye,et),ae=e=>{if(e=e.replace(/\s+/g,""),!Ge.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let n,t="",r,o;for(let i=0;i<e.length;)n=R[e.charAt(i++)]<<18|R[e.charAt(i++)]<<12|(r=R[e.charAt(i++)])<<6|(o=R[e.charAt(i++)]),t+=r===64?h(n>>16&255):o===64?h(n>>16&255,n>>8&255):h(n>>16&255,n>>8&255,n&255);return t},T=Ze?e=>atob(ee(e)):_?e=>Buffer.from(e,"base64").toString("binary"):ae,se=_?e=>Q(Buffer.from(e,"base64")):e=>Q(T(e),n=>n.charCodeAt(0)),ue=e=>se(le(e)),tt=_?e=>Buffer.from(e,"base64").toString("utf8"):G?e=>G.decode(se(e)):e=>ie(T(e)),le=e=>ee(e.replace(/[-_]/g,n=>n=="-"?"+":"/")),q=e=>tt(le(e)),nt=e=>{if(typeof e!="string")return!1;const n=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(n)||!/[^\s0-9a-zA-Z\-_]/.test(n)},fe=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),ce=function(){const e=(n,t)=>Object.defineProperty(String.prototype,n,fe(t));e("fromBase64",function(){return q(this)}),e("toBase64",function(n){return m(this,n)}),e("toBase64URI",function(){return m(this,!0)}),e("toBase64URL",function(){return m(this,!0)}),e("toUint8Array",function(){return ue(this)})},pe=function(){const e=(n,t)=>Object.defineProperty(Uint8Array.prototype,n,fe(t));e("toBase64",function(n){return O(this,n)}),e("toBase64URI",function(){return O(this,!0)}),e("toBase64URL",function(){return O(this,!0)})},rt={version:W,VERSION:Ke,atob:T,atobPolyfill:ae,btoa:D,btoaPolyfill:te,fromBase64:q,toBase64:m,encode:m,encodeURI:oe,encodeURL:oe,utob:ne,btou:ie,decode:q,isValid:nt,fromUint8Array:O,toUint8Array:ue,extendString:ce,extendUint8Array:pe,extendBuiltins:()=>{ce(),pe()}};var he=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ot=function(n,t){if(t=t.split(":")[0],n=+n,!n)return!1;switch(t){case"http":case"ws":return n!==80;case"https":case"wss":return n!==443;case"ftp":return n!==21;case"gopher":return n!==70;case"file":return!1}return n!==0},F={},it=Object.prototype.hasOwnProperty,at;function de(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch{return null}}function ye(e){try{return encodeURIComponent(e)}catch{return null}}function st(e){for(var n=/([^=?#&]+)=?([^&]*)/g,t={},r;r=n.exec(e);){var o=de(r[1]),i=de(r[2]);o===null||i===null||o in t||(t[o]=i)}return t}function ut(e,n){n=n||"";var t=[],r,o;typeof n!="string"&&(n="?");for(o in e)if(it.call(e,o)){if(r=e[o],!r&&(r===null||r===at||isNaN(r))&&(r=""),o=ye(o),r=ye(r),o===null||r===null)continue;t.push(o+"="+r)}return t.length?n+t.join("&"):""}F.stringify=ut,F.parse=st;var _e=ot,x=F,lt=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,me=/[\n\r\t]/g,ft=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,ge=/:\d+$/,ct=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,pt=/^[a-zA-Z]:/;function z(e){return(e||"").toString().replace(lt,"")}var H=[["#","hash"],["?","query"],function(n,t){return d(t.protocol)?n.replace(/\\/g,"/"):n},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],ve={hash:1,query:1};function be(e){var n;typeof window<"u"?n=window:typeof he<"u"?n=he:typeof self<"u"?n=self:n={};var t=n.location||{};e=e||t;var r={},o=typeof e,i;if(e.protocol==="blob:")r=new y(unescape(e.pathname),{});else if(o==="string"){r=new y(e,{});for(i in ve)delete r[i]}else if(o==="object"){for(i in e)i in ve||(r[i]=e[i]);r.slashes===void 0&&(r.slashes=ft.test(e.href))}return r}function d(e){return e==="file:"||e==="ftp:"||e==="http:"||e==="https:"||e==="ws:"||e==="wss:"}function Ue(e,n){e=z(e),e=e.replace(me,""),n=n||{};var t=ct.exec(e),r=t[1]?t[1].toLowerCase():"",o=!!t[2],i=!!t[3],s=0,a;return o?i?(a=t[2]+t[3]+t[4],s=t[2].length+t[3].length):(a=t[2]+t[4],s=t[2].length):i?(a=t[3]+t[4],s=t[3].length):a=t[4],r==="file:"?s>=2&&(a=a.slice(2)):d(r)?a=t[4]:r?o&&(a=a.slice(2)):s>=2&&d(n.protocol)&&(a=t[4]),{protocol:r,slashes:o||d(r),slashesCount:s,rest:a}}function ht(e,n){if(e==="")return n;for(var t=(n||"/").split("/").slice(0,-1).concat(e.split("/")),r=t.length,o=t[r-1],i=!1,s=0;r--;)t[r]==="."?t.splice(r,1):t[r]===".."?(t.splice(r,1),s++):s&&(r===0&&(i=!0),t.splice(r,1),s--);return i&&t.unshift(""),(o==="."||o==="..")&&t.push(""),t.join("/")}function y(e,n,t){if(e=z(e),e=e.replace(me,""),!(this instanceof y))return new y(e,n,t);var r,o,i,s,a,l,f=H.slice(),c=typeof n,u=this,p=0;for(c!=="object"&&c!=="string"&&(t=n,n=null),t&&typeof t!="function"&&(t=x.parse),n=be(n),o=Ue(e||"",n),r=!o.protocol&&!o.slashes,u.slashes=o.slashes||r&&n.slashes,u.protocol=o.protocol||n.protocol||"",e=o.rest,(o.protocol==="file:"&&(o.slashesCount!==2||pt.test(e))||!o.slashes&&(o.protocol||o.slashesCount<2||!d(u.protocol)))&&(f[3]=[/(.*)/,"pathname"]);p<f.length;p++){if(s=f[p],typeof s=="function"){e=s(e,u);continue}i=s[0],l=s[1],i!==i?u[l]=e:typeof i=="string"?(a=i==="@"?e.lastIndexOf(i):e.indexOf(i),~a&&(typeof s[2]=="number"?(u[l]=e.slice(0,a),e=e.slice(a+s[2])):(u[l]=e.slice(a),e=e.slice(0,a)))):(a=i.exec(e))&&(u[l]=a[1],e=e.slice(0,a.index)),u[l]=u[l]||r&&s[3]&&n[l]||"",s[4]&&(u[l]=u[l].toLowerCase())}t&&(u.query=t(u.query)),r&&n.slashes&&u.pathname.charAt(0)!=="/"&&(u.pathname!==""||n.pathname!=="")&&(u.pathname=ht(u.pathname,n.pathname)),u.pathname.charAt(0)!=="/"&&d(u.protocol)&&(u.pathname="/"+u.pathname),_e(u.port,u.protocol)||(u.host=u.hostname,u.port=""),u.username=u.password="",u.auth&&(a=u.auth.indexOf(":"),~a?(u.username=u.auth.slice(0,a),u.username=encodeURIComponent(decodeURIComponent(u.username)),u.password=u.auth.slice(a+1),u.password=encodeURIComponent(decodeURIComponent(u.password))):u.username=encodeURIComponent(decodeURIComponent(u.auth)),u.auth=u.password?u.username+":"+u.password:u.username),u.origin=u.protocol!=="file:"&&d(u.protocol)&&u.host?u.protocol+"//"+u.host:"null",u.href=u.toString()}function dt(e,n,t){var r=this;switch(e){case"query":typeof n=="string"&&n.length&&(n=(t||x.parse)(n)),r[e]=n;break;case"port":r[e]=n,_e(n,r.protocol)?n&&(r.host=r.hostname+":"+n):(r.host=r.hostname,r[e]="");break;case"hostname":r[e]=n,r.port&&(n+=":"+r.port),r.host=n;break;case"host":r[e]=n,ge.test(n)?(n=n.split(":"),r.port=n.pop(),r.hostname=n.join(":")):(r.hostname=n,r.port="");break;case"protocol":r.protocol=n.toLowerCase(),r.slashes=!t;break;case"pathname":case"hash":if(n){var o=e==="pathname"?"/":"#";r[e]=n.charAt(0)!==o?o+n:n}else r[e]=n;break;case"username":case"password":r[e]=encodeURIComponent(n);break;case"auth":var i=n.indexOf(":");~i?(r.username=n.slice(0,i),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=n.slice(i+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(n))}for(var s=0;s<H.length;s++){var a=H[s];a[4]&&(r[a[1]]=r[a[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin=r.protocol!=="file:"&&d(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r}function yt(e){(!e||typeof e!="function")&&(e=x.stringify);var n,t=this,r=t.host,o=t.protocol;o&&o.charAt(o.length-1)!==":"&&(o+=":");var i=o+(t.protocol&&t.slashes||d(t.protocol)?"//":"");return t.username?(i+=t.username,t.password&&(i+=":"+t.password),i+="@"):t.password?(i+=":"+t.password,i+="@"):t.protocol!=="file:"&&d(t.protocol)&&!r&&t.pathname!=="/"&&(i+="@"),(r[r.length-1]===":"||ge.test(t.hostname)&&!t.port)&&(r+=":"),i+=r+t.pathname,n=typeof t.query=="object"?e(t.query):t.query,n&&(i+=n.charAt(0)!=="?"?"?"+n:n),t.hash&&(i+=t.hash),i}y.prototype={set:dt,toString:yt},y.extractProtocol=Ue,y.location=be,y.trimLeft=z,y.qs=x;var _t=y;function $(e){return $=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},$(e)}function we(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function mt(e,n,t){return n&&we(e.prototype,n),t&&we(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function gt(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function vt(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&w(e,n)}function bt(e){var n=Se();return function(){var r=S(e),o;if(n){var i=S(this).constructor;o=Reflect.construct(r,arguments,i)}else o=r.apply(this,arguments);return Ut(this,o)}}function Ut(e,n){if(n&&($(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return wt(e)}function wt(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e){var n=typeof Map=="function"?new Map:void 0;return I=function(r){if(r===null||!St(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof n<"u"){if(n.has(r))return n.get(r);n.set(r,o)}function o(){return P(r,arguments,S(this).constructor)}return o.prototype=Object.create(r.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),w(o,r)},I(e)}function P(e,n,t){return Se()?P=Reflect.construct.bind():P=function(o,i,s){var a=[null];a.push.apply(a,i);var l=Function.bind.apply(o,a),f=new l;return s&&w(f,s.prototype),f},P.apply(null,arguments)}function Se(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function St(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function w(e,n){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},w(e,n)}function S(e){return S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},S(e)}var E=function(e){vt(t,e);var n=bt(t);function t(r){var o,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(gt(this,t),o=n.call(this,r),o.originalRequest=s,o.originalResponse=a,o.causingError=i,i!=null&&(r+=", caused by ".concat(i.toString())),s!=null){var l=s.getHeader("X-Request-ID")||"n/a",f=s.getMethod(),c=s.getURL(),u=a?a.getStatus():"n/a",p=a?a.getBody()||"":"n/a";r+=", originated from request (method: ".concat(f,", url: ").concat(c,", response code: ").concat(u,", response text: ").concat(p,", request id: ").concat(l,")")}return o.message=r,o}return mt(t)}(I(Error));function Rn(e){}function Rt(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=Math.random()*16|0,t=e==="x"?n:n&3|8;return t.toString(16)})}function Re(e,n){return Et(e)||Pt(e,n)||xt(e,n)||Ot()}function Ot(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xt(e,n){if(!!e){if(typeof e=="string")return Oe(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Oe(e,n)}}function Oe(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function Pt(e,n){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var r=[],o=!0,i=!1,s,a;try{for(t=t.call(e);!(o=(s=t.next()).done)&&(r.push(s.value),!(n&&r.length===n));o=!0);}catch(l){i=!0,a=l}finally{try{!o&&t.return!=null&&t.return()}finally{if(i)throw a}}return r}}function Et(e){if(Array.isArray(e))return e}function xe(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),t.push.apply(t,r)}return t}function g(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?xe(Object(t),!0).forEach(function(r){kt(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):xe(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function kt(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function At(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function Pe(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ct(e,n,t){return n&&Pe(e.prototype,n),t&&Pe(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}var jt={endpoint:null,uploadUrl:null,metadata:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,_onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:null,chunkSize:1/0,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null},k=function(){function e(n,t){At(this,e),"resume"in t&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=t,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=n,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}return Ct(e,[{key:"findPreviousUploads",value:function(){var t=this;return this.options.fingerprint(this.file,this.options).then(function(r){return t._urlStorage.findUploadsByFingerprint(r)})}},{key:"resumeFromPreviousUpload",value:function(t){this.url=t.uploadUrl||null,this._parallelUploadUrls=t.parallelUploadUrls||null,this._urlStorageKey=t.urlStorageKey}},{key:"start",value:function(){var t=this,r=this.file;if(!r){this._emitError(new Error("tus: no file or stream to upload provided"));return}if(!this.options.endpoint&&!this.options.uploadUrl&&!this.url){this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));return}var o=this.options.retryDelays;if(o!=null&&Object.prototype.toString.call(o)!=="[object Array]"){this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"));return}if(this.options.parallelUploads>1)for(var i=0,s=["uploadUrl","uploadSize","uploadLengthDeferred"];i<s.length;i++){var a=s[i];if(this.options[a]){this._emitError(new Error("tus: cannot use the ".concat(a," option when parallelUploads is enabled")));return}}if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1){this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));return}if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length){this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"));return}}this.options.fingerprint(r,this.options).then(function(l){return t._fingerprint=l,t._source?t._source:t.options.fileReader.openFile(r,t.options.chunkSize)}).then(function(l){if(t._source=l,t.options.uploadLengthDeferred)t._size=null;else if(t.options.uploadSize!=null){if(t._size=Number(t.options.uploadSize),Number.isNaN(t._size)){t._emitError(new Error("tus: cannot convert `uploadSize` option into a number"));return}}else if(t._size=t._source.size,t._size==null){t._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));return}t.options.parallelUploads>1||t._parallelUploadUrls!=null?t._startParallelUpload():t._startSingleUpload()}).catch(function(l){t._emitError(l)})}},{key:"_startParallelUpload",value:function(){var t,r=this,o=this._size,i=0;this._parallelUploads=[];var s=this._parallelUploadUrls!=null?this._parallelUploadUrls.length:this.options.parallelUploads,a=(t=this.options.parallelUploadBoundaries)!==null&&t!==void 0?t:Bt(this._source.size,s);this._parallelUploadUrls&&a.forEach(function(c,u){c.uploadUrl=r._parallelUploadUrls[u]||null}),this._parallelUploadUrls=new Array(a.length);var l=a.map(function(c,u){var p=0;return r._source.slice(c.start,c.end).then(function(Z){var C=Z.value;return new Promise(function(vn,bn){var Un=g(g({},r.options),{},{uploadUrl:c.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:{},headers:g(g({},r.options.headers),{},{"Upload-Concat":"partial"}),onSuccess:vn,onError:bn,onProgress:function(j){i=i-p+j,p=j,r._emitProgress(i,o)},_onUploadUrlAvailable:function(){r._parallelUploadUrls[u]=V.url,r._parallelUploadUrls.filter(function(j){return Boolean(j)}).length===a.length&&r._saveUploadInUrlStorage()}}),V=new e(C,Un);V.start(),r._parallelUploads.push(V)})})}),f;Promise.all(l).then(function(){f=r._openRequest("POST",r.options.endpoint),f.setHeader("Upload-Concat","final;".concat(r._parallelUploadUrls.join(" ")));var c=Ee(r.options.metadata);return c!==""&&f.setHeader("Upload-Metadata",c),r._sendRequest(f,null)}).then(function(c){if(!v(c.getStatus(),200)){r._emitHttpError(f,c,"tus: unexpected response while creating upload");return}var u=c.getHeader("Location");if(u==null){r._emitHttpError(f,c,"tus: invalid or missing Location header");return}r.url=je(r.options.endpoint,u),"Created upload at ".concat(r.url),r._emitSuccess()}).catch(function(c){r._emitError(c)})}},{key:"_startSingleUpload",value:function(){if(this._aborted=!1,this.url!=null){"Resuming upload from previous URL: ".concat(this.url),this._resumeUpload();return}if(this.options.uploadUrl!=null){"Resuming upload from provided URL: ".concat(this.options.uploadUrl),this.url=this.options.uploadUrl,this._resumeUpload();return}this._createUpload()}},{key:"abort",value:function(t){var r=this;return this._parallelUploads!=null&&this._parallelUploads.forEach(function(o){o.abort(t)}),this._req!==null&&this._req.abort(),this._aborted=!0,this._retryTimeout!=null&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),!t||this.url==null?Promise.resolve():e.terminate(this.url,this.options).then(function(){return r._removeFromUrlStorage()})}},{key:"_emitHttpError",value:function(t,r,o,i){this._emitError(new E(o,i,t,r))}},{key:"_emitError",value:function(t){var r=this;if(!this._aborted){if(this.options.retryDelays!=null){var o=this._offset!=null&&this._offset>this._offsetBeforeRetry;if(o&&(this._retryAttempt=0),Ce(t,this._retryAttempt,this.options)){var i=this.options.retryDelays[this._retryAttempt++];this._offsetBeforeRetry=this._offset,this._retryTimeout=setTimeout(function(){r.start()},i);return}}if(typeof this.options.onError=="function")this.options.onError(t);else throw t}}},{key:"_emitSuccess",value:function(){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),typeof this.options.onSuccess=="function"&&this.options.onSuccess()}},{key:"_emitProgress",value:function(t,r){typeof this.options.onProgress=="function"&&this.options.onProgress(t,r)}},{key:"_emitChunkComplete",value:function(t,r,o){typeof this.options.onChunkComplete=="function"&&this.options.onChunkComplete(t,r,o)}},{key:"_createUpload",value:function(){var t=this;if(!this.options.endpoint){this._emitError(new Error("tus: unable to create upload because no endpoint is provided"));return}var r=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?r.setHeader("Upload-Defer-Length",1):r.setHeader("Upload-Length",this._size);var o=Ee(this.options.metadata);o!==""&&r.setHeader("Upload-Metadata",o);var i;this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,i=this._addChunkToRequest(r)):i=this._sendRequest(r,null),i.then(function(s){if(!v(s.getStatus(),200)){t._emitHttpError(r,s,"tus: unexpected response while creating upload");return}var a=s.getHeader("Location");if(a==null){t._emitHttpError(r,s,"tus: invalid or missing Location header");return}if(t.url=je(t.options.endpoint,a),"Created upload at ".concat(t.url),typeof t.options._onUploadUrlAvailable=="function"&&t.options._onUploadUrlAvailable(),t._size===0){t._emitSuccess(),t._source.close();return}t._saveUploadInUrlStorage().then(function(){t.options.uploadDataDuringCreation?t._handleUploadResponse(r,s):(t._offset=0,t._performUpload())})}).catch(function(s){t._emitHttpError(r,null,"tus: failed to create upload",s)})}},{key:"_resumeUpload",value:function(){var t=this,r=this._openRequest("HEAD",this.url),o=this._sendRequest(r,null);o.then(function(i){var s=i.getStatus();if(!v(s,200)){if(s===423){t._emitHttpError(r,i,"tus: upload is currently locked; retry later");return}if(v(s,400)&&t._removeFromUrlStorage(),!t.options.endpoint){t._emitHttpError(r,i,"tus: unable to resume upload (new upload cannot be created without an endpoint)");return}t.url=null,t._createUpload();return}var a=parseInt(i.getHeader("Upload-Offset"),10);if(Number.isNaN(a)){t._emitHttpError(r,i,"tus: invalid or missing offset value");return}var l=parseInt(i.getHeader("Upload-Length"),10);if(Number.isNaN(l)&&!t.options.uploadLengthDeferred){t._emitHttpError(r,i,"tus: invalid or missing length value");return}typeof t.options._onUploadUrlAvailable=="function"&&t.options._onUploadUrlAvailable(),t._saveUploadInUrlStorage().then(function(){if(a===l){t._emitProgress(l,l),t._emitSuccess();return}t._offset=a,t._performUpload()})}).catch(function(i){t._emitHttpError(r,null,"tus: failed to resume upload",i)})}},{key:"_performUpload",value:function(){var t=this;if(!this._aborted){var r;this.options.overridePatchMethod?(r=this._openRequest("POST",this.url),r.setHeader("X-HTTP-Method-Override","PATCH")):r=this._openRequest("PATCH",this.url),r.setHeader("Upload-Offset",this._offset);var o=this._addChunkToRequest(r);o.then(function(i){if(!v(i.getStatus(),200)){t._emitHttpError(r,i,"tus: unexpected response while uploading chunk");return}t._handleUploadResponse(r,i)}).catch(function(i){t._aborted||t._emitHttpError(r,null,"tus: failed to upload chunk at offset ".concat(t._offset),i)})}}},{key:"_addChunkToRequest",value:function(t){var r=this,o=this._offset,i=this._offset+this.options.chunkSize;return t.setProgressHandler(function(s){r._emitProgress(o+s,r._size)}),t.setHeader("Content-Type","application/offset+octet-stream"),(i===1/0||i>this._size)&&!this.options.uploadLengthDeferred&&(i=this._size),this._source.slice(o,i).then(function(s){var a=s.value,l=s.done;return r.options.uploadLengthDeferred&&l&&(r._size=r._offset+(a&&a.size?a.size:0),t.setHeader("Upload-Length",r._size)),a===null?r._sendRequest(t):(r._emitProgress(r._offset,r._size),r._sendRequest(t,a))})}},{key:"_handleUploadResponse",value:function(t,r){var o=parseInt(r.getHeader("Upload-Offset"),10);if(Number.isNaN(o)){this._emitHttpError(t,r,"tus: invalid or missing offset value");return}if(this._emitProgress(o,this._size),this._emitChunkComplete(o-this._offset,o,this._size),this._offset=o,o===this._size){this._emitSuccess(),this._source.close();return}this._performUpload()}},{key:"_openRequest",value:function(t,r){var o=ke(t,r,this.options);return this._req=o,o}},{key:"_removeFromUrlStorage",value:function(){var t=this;!this._urlStorageKey||(this._urlStorage.removeUpload(this._urlStorageKey).catch(function(r){t._emitError(r)}),this._urlStorageKey=null)}},{key:"_saveUploadInUrlStorage",value:function(){var t=this;if(!this.options.storeFingerprintForResuming||!this._fingerprint||this._urlStorageKey!==null)return Promise.resolve();var r={size:this._size,metadata:this.options.metadata,creationTime:new Date().toString()};return this._parallelUploads?r.parallelUploadUrls=this._parallelUploadUrls:r.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,r).then(function(o){t._urlStorageKey=o})}},{key:"_sendRequest",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return Ae(t,r,this.options)}}],[{key:"terminate",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=ke("DELETE",t,r);return Ae(o,null,r).then(function(i){if(i.getStatus()!==204)throw new E("tus: unexpected response while terminating upload",null,o,i)}).catch(function(i){if(i instanceof E||(i=new E("tus: failed to terminate upload",i,o,null)),!Ce(i,0,r))throw i;var s=r.retryDelays[0],a=r.retryDelays.slice(1),l=g(g({},r),{},{retryDelays:a});return new Promise(function(f){return setTimeout(f,s)}).then(function(){return e.terminate(t,l)})})}}]),e}();function Ee(e){return Object.entries(e).map(function(n){var t=Re(n,2),r=t[0],o=t[1];return"".concat(r," ").concat(rt.encode(String(o)))}).join(",")}function v(e,n){return e>=n&&e<n+100}function ke(e,n,t){var r=t.httpStack.createRequest(e,n);r.setHeader("Tus-Resumable","1.0.0");var o=t.headers||{};if(Object.entries(o).forEach(function(s){var a=Re(s,2),l=a[0],f=a[1];r.setHeader(l,f)}),t.addRequestId){var i=Rt();r.setHeader("X-Request-ID",i)}return r}function Ae(e,n,t){var r=typeof t.onBeforeRequest=="function"?Promise.resolve(t.onBeforeRequest(e)):Promise.resolve();return r.then(function(){return e.send(n).then(function(o){var i=typeof t.onAfterResponse=="function"?Promise.resolve(t.onAfterResponse(e,o)):Promise.resolve();return i.then(function(){return o})})})}function Dt(){var e=!0;return typeof window<"u"&&"navigator"in window&&window.navigator.onLine===!1&&(e=!1),e}function Ce(e,n,t){if(t.retryDelays==null||n>=t.retryDelays.length||e.originalRequest==null)return!1;if(t&&typeof t.onShouldRetry=="function")return t.onShouldRetry(e,n,t);var r=e.originalResponse?e.originalResponse.getStatus():0;return(!v(r,400)||r===409||r===423)&&Dt()}function je(e,n){return new _t(n,e).toString()}function Bt(e,n){for(var t=Math.floor(e/n),r=[],o=0;o<n;o++)r.push({start:t*o,end:t*(o+1)});return r[n-1].end=e,r}k.defaultOptions=jt;function Tt(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function De(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qt(e,n,t){return n&&De(e.prototype,n),t&&De(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}var Ft=function(){function e(){Tt(this,e)}return qt(e,[{key:"listAllUploads",value:function(){return Promise.resolve([])}},{key:"findUploadsByFingerprint",value:function(t){return Promise.resolve([])}},{key:"removeUpload",value:function(t){return Promise.resolve()}},{key:"addUpload",value:function(t,r){return Promise.resolve(null)}}]),e}();function zt(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function Be(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ht(e,n,t){return n&&Be(e.prototype,n),t&&Be(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}var L=!1;try{L="localStorage"in window;var Te="tusSupport";localStorage.setItem(Te,localStorage.getItem(Te))}catch(e){if(e.code===e.SECURITY_ERR||e.code===e.QUOTA_EXCEEDED_ERR)L=!1;else throw e}var $t=L,It=function(){function e(){zt(this,e)}return Ht(e,[{key:"findAllUploads",value:function(){var t=this._findEntries("tus::");return Promise.resolve(t)}},{key:"findUploadsByFingerprint",value:function(t){var r=this._findEntries("tus::".concat(t,"::"));return Promise.resolve(r)}},{key:"removeUpload",value:function(t){return localStorage.removeItem(t),Promise.resolve()}},{key:"addUpload",value:function(t,r){var o=Math.round(Math.random()*1e12),i="tus::".concat(t,"::").concat(o);return localStorage.setItem(i,JSON.stringify(r)),Promise.resolve(i)}},{key:"_findEntries",value:function(t){for(var r=[],o=0;o<localStorage.length;o++){var i=localStorage.key(o);if(i.indexOf(t)===0)try{var s=JSON.parse(localStorage.getItem(i));s.urlStorageKey=i,r.push(s)}catch{}}return r}}]),e}();function N(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function qe(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e,n,t){return n&&qe(e.prototype,n),t&&qe(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}var Lt=function(){function e(){N(this,e)}return M(e,[{key:"createRequest",value:function(t,r){return new Nt(t,r)}},{key:"getName",value:function(){return"XHRHttpStack"}}]),e}(),Nt=function(){function e(n,t){N(this,e),this._xhr=new XMLHttpRequest,this._xhr.open(n,t,!0),this._method=n,this._url=t,this._headers={}}return M(e,[{key:"getMethod",value:function(){return this._method}},{key:"getURL",value:function(){return this._url}},{key:"setHeader",value:function(t,r){this._xhr.setRequestHeader(t,r),this._headers[t]=r}},{key:"getHeader",value:function(t){return this._headers[t]}},{key:"setProgressHandler",value:function(t){"upload"in this._xhr&&(this._xhr.upload.onprogress=function(r){!r.lengthComputable||t(r.loaded)})}},{key:"send",value:function(){var t=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return new Promise(function(o,i){t._xhr.onload=function(){o(new Mt(t._xhr))},t._xhr.onerror=function(s){i(s)},t._xhr.send(r)})}},{key:"abort",value:function(){return this._xhr.abort(),Promise.resolve()}},{key:"getUnderlyingObject",value:function(){return this._xhr}}]),e}(),Mt=function(){function e(n){N(this,e),this._xhr=n}return M(e,[{key:"getStatus",value:function(){return this._xhr.status}},{key:"getHeader",value:function(t){return this._xhr.getResponseHeader(t)}},{key:"getBody",value:function(){return this._xhr.responseText}},{key:"getUnderlyingObject",value:function(){return this._xhr}}]),e}(),Fe=function(){return typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative"};function Xt(e){return new Promise(function(n,t){var r=new XMLHttpRequest;r.responseType="blob",r.onload=function(){var o=r.response;n(o)},r.onerror=function(o){t(o)},r.open("GET",e),r.send()})}var Kt=function(){return typeof window<"u"&&(typeof window.PhoneGap<"u"||typeof window.Cordova<"u"||typeof window.cordova<"u")};function Zt(e){return new Promise(function(n,t){var r=new FileReader;r.onload=function(){var o=new Uint8Array(r.result);n({value:o})},r.onerror=function(o){t(o)},r.readAsArrayBuffer(e)})}function Vt(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function ze(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Wt(e,n,t){return n&&ze(e.prototype,n),t&&ze(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}var He=function(){function e(n){Vt(this,e),this._file=n,this.size=n.size}return Wt(e,[{key:"slice",value:function(t,r){if(Kt())return Zt(this._file.slice(t,r));var o=this._file.slice(t,r);return Promise.resolve({value:o})}},{key:"close",value:function(){}}]),e}();function Gt(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function $e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Jt(e,n,t){return n&&$e(e.prototype,n),t&&$e(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ie(e){return e===void 0?0:e.size!==void 0?e.size:e.length}function Qt(e,n){if(e.concat)return e.concat(n);if(e instanceof Blob)return new Blob([e,n],{type:e.type});if(e.set){var t=new e.constructor(e.length+n.length);return t.set(e),t.set(n,e.length),t}throw new Error("Unknown data type")}var Yt=function(){function e(n){Gt(this,e),this._buffer=void 0,this._bufferOffset=0,this._reader=n,this._done=!1}return Jt(e,[{key:"slice",value:function(t,r){return t<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(t,r)}},{key:"_readUntilEnoughDataOrDone",value:function(t,r){var o=this,i=r<=this._bufferOffset+Ie(this._buffer);if(this._done||i){var s=this._getDataFromBuffer(t,r),a=s==null?this._done:!1;return Promise.resolve({value:s,done:a})}return this._reader.read().then(function(l){var f=l.value,c=l.done;return c?o._done=!0:o._buffer===void 0?o._buffer=f:o._buffer=Qt(o._buffer,f),o._readUntilEnoughDataOrDone(t,r)})}},{key:"_getDataFromBuffer",value:function(t,r){t>this._bufferOffset&&(this._buffer=this._buffer.slice(t-this._bufferOffset),this._bufferOffset=t);var o=Ie(this._buffer)===0;return this._done&&o?null:this._buffer.slice(0,r-t)}},{key:"close",value:function(){this._reader.cancel&&this._reader.cancel()}}]),e}();function en(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function Le(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function tn(e,n,t){return n&&Le(e.prototype,n),t&&Le(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}var nn=function(){function e(){en(this,e)}return tn(e,[{key:"openFile",value:function(t,r){return Fe()&&t&&typeof t.uri<"u"?Xt(t.uri).then(function(o){return new He(o)}).catch(function(o){throw new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. ".concat(o))}):typeof t.slice=="function"&&typeof t.size<"u"?Promise.resolve(new He(t)):typeof t.read=="function"?(r=Number(r),Number.isFinite(r)?Promise.resolve(new Yt(t,r)):Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option"))):Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment"))}}]),e}();function rn(e,n){return Fe()?Promise.resolve(on(e,n)):Promise.resolve(["tus-br",e.name,e.type,e.size,e.lastModified,n.endpoint].join("-"))}function on(e,n){var t=e.exif?an(JSON.stringify(e.exif)):"noexif";return["tus-rn",e.name||"noname",e.size||"nosize",t,n.endpoint].join("/")}function an(e){var n=0;if(e.length===0)return n;for(var t=0;t<e.length;t++){var r=e.charCodeAt(t);n=(n<<5)-n+r,n&=n}return n}function X(e){return X=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},X(e)}function sn(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function Ne(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function un(e,n,t){return n&&Ne(e.prototype,n),t&&Ne(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function ln(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&K(e,n)}function K(e,n){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},K(e,n)}function fn(e){var n=hn();return function(){var r=A(e),o;if(n){var i=A(this).constructor;o=Reflect.construct(r,arguments,i)}else o=r.apply(this,arguments);return cn(this,o)}}function cn(e,n){if(n&&(X(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return pn(e)}function pn(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hn(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function A(e){return A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},A(e)}function Me(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),t.push.apply(t,r)}return t}function b(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?Me(Object(t),!0).forEach(function(r){dn(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Me(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function dn(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var Xe=b(b({},k.defaultOptions),{},{httpStack:new Lt,fileReader:new nn,urlStorage:$t?new It:new Ft,fingerprint:rn}),yn=function(e){ln(t,e);var n=fn(t);function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return sn(this,t),o=b(b({},Xe),o),n.call(this,r,o)}return un(t,null,[{key:"terminate",value:function(o){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return i=b(b({},Xe),i),k.terminate(o,i)}}]),t}(k);function _n(e,n,t,r,o,i,s,a){var l=typeof e=="function"?e.options:e;n&&(l.render=n,l.staticRenderFns=t,l._compiled=!0),r&&(l.functional=!0),i&&(l._scopeId="data-v-"+i);var f;if(s?(f=function(p){p=p||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!p&&typeof __VUE_SSR_CONTEXT__<"u"&&(p=__VUE_SSR_CONTEXT__),o&&o.call(this,p),p&&p._registeredComponents&&p._registeredComponents.add(s)},l._ssrRegister=f):o&&(f=a?function(){o.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:o),f)if(l.functional){l._injectStyles=f;var c=l.render;l.render=function(Z,C){return f.call(C),c(Z,C)}}else{var u=l.beforeCreate;l.beforeCreate=u?[].concat(u,f):[f]}return{exports:e,options:l}}var mn=_n({extends:"k-upload",methods:{async upload(e){let n=this,{bytes:t}=await this.$api.get("dgtlone/chunky/chunk_size");this.$refs.dialog.open(),this.files=[...e],this.completed={},this.errors=[],this.hasErrors=!1,this.limit&&(this.files=this.files.slice(0,this.limit)),this.total=this.files.length,this.files.forEach(r=>{var i,s;let o=new yn(r,{endpoint:n.$urls.api+"/dgtlone/chunky/upload",chunkSize:t,retryDelays:[0,3e3,5e3,1e4,2e4],removeFingerprintOnSuccess:!0,headers:{"X-CSRF":n.$system.csrf,"X-Target-Path":n.$view.path},metadata:{filename:r.name,filetype:r.type},onError:function(a){n.errors.push({file:r,message:a}),n.complete(r,a)},onProgress:function(a,l){var c,u;var f=(a/l*100).toFixed(2);(u=(c=n.$refs[r.name])==null?void 0:c[0])==null||u.set(f)},onSuccess:function(){n.complete(r,!0)}});o.findPreviousUploads().then(function(a){a.length&&o.resumeFromPreviousUpload(a[0]),o.start()}),((s=(i=this.options)==null?void 0:i.attributes)==null?void 0:s.sort)!==void 0&&this.options.attributes.sort++})}}},null,null,!1,null,null,null,null);const gn=mn.exports;panel.plugin("dgtlone/kirby-chunky",{components:{"k-upload":gn}})})();
